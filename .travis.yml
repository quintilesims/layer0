sudo: required

language: go

go:
  - 1.14

services:
  - docker

before_install:
  - sudo apt-get install jq

script:
  - make unittest

before_deploy:
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
  - make release

deploy:
- provider: releases
  api_key:
    # Encrypted personal access token of `carbon-bot-user` github user
    # Encrypted with `travis encrypt [TOKEN]`
    secure: "GG36ACvf6D4wE3XRy7kN9JbQg9SM5UvG+G86R0xki087jORBfgUiVByCYnbZKcpMy0fCdMc8Kr69YEPqNjBnQ3ZGeWbl1Jni9c+FwGiNA/e5Vfml/6yp+VbJJ17wvEwQ4kVngP8JeKKiZ/aZC+8FlIkeYOxytodUvMG92rlIatfFsUGQBbUn7T4IKMo6M6e+SLxgq7+I8hpO1AjghTPLUvh8G8s4CesPya13yVca/ZCbNdSpf7JhcT2oWZEUp5S39yIMMDEsZ4rJatfwZEq8oUPI2m6twMOVQVXB44INgGPaRWlQHfnbV+u2bloknHuNP+n/44u3AQF8LT8eiBhWIeY9eP/mZcdL+wkiBppzye6iczGiaT9GaueVBJCGAy17aYl14iaz5vYvkLAbGa7q1+MtPKz5e4zBOr0OUdRFS+D966XlaoeOzM1O4zMf/ToLC4YlzCU4Y5uSbkxgriMM9Y9Cnj8JKmRzgiQf4X5cRs26o0C7jREq9g7i3f2Bsd0Q/oO7LTYDnWOfKoH6uTO1Pa3gFaoDKvUAdH4W5ESGg8rlyUpZum2xmBfJ+w2fzPOC6Nn3seAXI94jqoenQn6pj5R8a7A6btD4H8LlCbmQk6clHofAUSaWfczB/C4FX3Oj1hkGGYDfyReq50i1agAx4UiFJvfuHxAa7zn+kYduWUk="
  file: 
   - build/macOS.zip
   - build/Linux.zip
   - build/Windows.zip
  skip_cleanup: true
  on:
    tags: true

after_deploy:
  - curl -X POST -F token="$GITLAB_PIPELINE_TOKEN" -F ref=master https://gitlab.ims.io/api/v4/projects/8293/trigger/pipeline
