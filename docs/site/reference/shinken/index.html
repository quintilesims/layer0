<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Shinken - Layer0</title>
      
      
      
        <link rel="canonical" href="https://gitlab.imshealth.com/xfra/layer0/reference/shinken/">
      
      
        <meta name="author" content="xfra">
      
    
    <meta property="og:url" content="https://gitlab.imshealth.com/xfra/layer0/reference/shinken/">
    <meta property="og:title" content="Layer0">
    <meta property="og:image" content="https://gitlab.imshealth.com/xfra/layer0/reference/shinken//../../static/logo_icon.png">
    <meta name="apple-mobile-web-app-title" content="Layer0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../static/logo_icon.png">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-b64b728552.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Roboto', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-red palette-accent-grey">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Reference <i class="icon icon-link"></i>
              
            
          </span>
        
        Shinken
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://gitlab.imshealth.com/xfra/layer0/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../static/logo_icon.png">
        </div>
      
      <div class="name">
        <strong>Layer0 v0.8.2</strong>
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Releases" href="../../releases/">
      Releases
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Introduction" href="../../intro/">
      Introduction
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Setup</span>
    <ul>
      
        
  <li>
    <a class="" title="Install" href="../../setup/install/">
      Install
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Upgrade" href="../../setup/update/">
      Upgrade
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Destroy" href="../../setup/destroy/">
      Destroy
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Guides</span>
    <ul>
      
        
  <li>
    <a class="" title="Guestbook" href="../../guides/guestbook/">
      Guestbook
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Guestbook with RDS" href="../../guides/guestbook_rds/">
      Guestbook with RDS
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Consul" href="../../guides/consul/">
      Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Guestbook with Consul" href="../../guides/guestbook_consul/">
      Guestbook with Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Shinken" href="../../guides/shinken/">
      Shinken
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Reference</span>
    <ul>
      
        
  <li>
    <a class="" title="Layer0 CLI" href="../cli/">
      Layer0 CLI
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Layer0 Setup CLI" href="../setup-cli/">
      Layer0 Setup CLI
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Consul" href="../consul/">
      Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Shinken" href="./">
      Shinken
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Consul Health Checks" href="#consul-health-checks">
                Consul Health Checks
              </a>
            </li>
          
            <li class="anchor">
              <a title="Consul HTTP Health Check" href="#consul-http-health-check">
                Consul HTTP Health Check
              </a>
            </li>
          
            <li class="anchor">
              <a title="Consul TTL Health Check" href="#consul-ttl-health-check">
                Consul TTL Health Check
              </a>
            </li>
          
            <li class="anchor">
              <a title="External Health Checks" href="#external-health-checks">
                External Health Checks
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Task Definitions" href="../task_definition/">
      Task Definitions
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Architecture" href="../architecture/">
      Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="ECR" href="../ecr/">
      ECR
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Troubleshooting</span>
    <ul>
      
        
  <li>
    <a class="" title="Common Issues" href="../../troubleshooting/commonissues/">
      Common Issues
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Secure Shell (SSH)" href="../../troubleshooting/ssh/">
      Secure Shell (SSH)
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="shinken">Shinken<a class="headerlink" href="#shinken" title="Permanent link">#</a></h1>
<p><a href="http://www.shinken-monitoring.org/">Shinken</a> is an open source monitoring framework for software applications.
XFRA provides <a href="https://gitlab.imshealth.com/xfra/layer1-shinken/tree/master">Layer1-Shinken</a>,
a containerized application that is optimized to integrate into your <a href="../../guides/consul">Consul-enabled</a> Layer0 Environment.</p>
<p>Layer1-Shinken dynamically detects:</p>
<ul>
<li>External URLs to query for status</li>
<li>Layer0 Services registered within Consul that have health checks configured</li>
<li>Alert notifications are delivered to your team via Slack</li>
</ul>
<h2 id="consul-health-checks">Consul Health Checks<a class="headerlink" href="#consul-health-checks" title="Permanent link">#</a></h2>
<hr />
<p>A <a href="https://www.consul.io/docs/agent/checks.html">Consul health check</a> is configurable on each published port in your service by setting environment variables. 
Consul uses these health checks internally to determine the healthy members of a service cluster.</p>
<p>The environment variables are detected by <a href="http://gliderlabs.com/registrator/latest/user/backends/#consul">Registrator</a>, which then automatically populates Consul when your container launches. 
You can specify at most one check per port.</p>
<h2 id="consul-http-health-check">Consul HTTP Health Check<a class="headerlink" href="#consul-http-health-check" title="Permanent link">#</a></h2>
<hr />
<p>HTTP Checks are the preferred method of monitoring service health in Consul.</p>
<p>The status of the service depends on the HTTP response code: </p>
<table>
<thead>
<tr>
<th>Status</th>
<th>Health</th>
</tr>
</thead>
<tbody>
<tr>
<td>200-299</td>
<td>Healthy (Green)</td>
</tr>
<tr>
<td>429</td>
<td>Warning (Yellow)</td>
</tr>
<tr>
<td>Other / No Response</td>
<td>Unhealthy (Red)</td>
</tr>
</tbody>
</table>
<p>HTTP Checks are configured by setting environment variables in your Layer0 Service's task definition. 
Services can configure one health check per port that the container exposes. 
The following environment variables are required for proper health check configuration:</p>
<p><em>The "<code>*</code>" portion of the environment variable must be replaced with an exposed port on the Service container.</em></p>
<ul>
<li><strong>SERVICE_*_NAME</strong>: The name of your Service</li>
<li><strong>SERVICE_*_CHECK_HTTP</strong>: The route of your health check</li>
<li><strong>SERVICE_*_CHECK_INTERVAL</strong>: The interval between health checks </li>
<li><strong>SERVICE_*_CHECK_TIMEOUT</strong>: The timeout for the health check</li>
</ul>
<p>Below is a snippet from a task defintion that configures a health check on port 80, against the <code>/</code> route, checking every 15 seconds with a 1 second timeout. </p>
<div class="code"><pre>&quot;environment&quot;: [
    {
        &quot;name&quot;: &quot;SERVICE_80_NAME&quot;,
        &quot;value&quot;: &quot;sample&quot;
    },
    {
        &quot;name&quot;: &quot;SERVICE_80_CHECK_HTTP&quot;,
        &quot;value&quot;: &quot;/&quot;
    },
    {
        &quot;name&quot;: &quot;SERVICE_80_CHECK_INTERVAL&quot;,
        &quot;value&quot;: &quot;15s&quot;
    },
    {
        &quot;name&quot;: &quot;SERVICE_80_CHECK_TIMEOUT&quot;,
        &quot;value&quot;: &quot;1s&quot;
    }
]
</pre></div>


<h2 id="consul-ttl-health-check">Consul TTL Health Check<a class="headerlink" href="#consul-ttl-health-check" title="Permanent link">#</a></h2>
<hr />
<p>Oftentimes, you'll find your Service does not support HTTP requests, in which case implementing an HTTP endpoint just for health checks is a burden, though a viable option.</p>
<p>An alternative is using TTL (time to live) health checks.
These checks retain their last known state for a given TTL.
The state of the check must be updated periodically over Consul's HTTP interface.
If an external system fails to update the status within a given TTL, the check is set to the failed state.
This mechanism, conceptually similar to a dead man's switch, relies on the application to directly report its health.
For example, a healthy app can periodically PUT a status update to the HTTP endpoint; if the app fails, the TTL will expire and the health check enters a critical state.</p>
<p>To enable a TTL check on Service, simply include the <code>SERVICE_CHECK_TTL</code> environment variable with your timeout duration.
For example:</p>
<div class="code"><pre>&quot;environment&quot;: [
    {
        &quot;name&quot;: &quot;SERVICE_6379_NAME&quot;,
        &quot;value&quot;: &quot;db&quot;
    },
    {
        &quot;name&quot;: &quot;SERVICE_6379_CHECK_TTL&quot;,
        &quot;value&quot;: &quot;30s&quot;
    }
]
</pre></div>


<p>This may sound burndensome as well, but can be quite lightweight. 
XFRA provides a simple example of doing this to provide a health check on Redis <a href="https://gitlab.imshealth.com/xfra/redis-ttl/tree/master">here</a>.</p>
<h2 id="external-health-checks">External Health Checks<a class="headerlink" href="#external-health-checks" title="Permanent link">#</a></h2>
<hr />
<p>Layer1-Shinken allows users to configure any number of external HTTP checks.
You can use this to monitor systems not managed by Layer0 from your Layer1-Shinken instance.</p>
<p>External checks simply report on the state of an HTTP(s) URL.
Check health does not affect the availability of your Service, as in the case of <a href="#consul-health-checks">Consul Health Checks</a>, which automatically removes services with failing checks.</p>
<p>To determine the health of a URL, external checks look at the HTTP Status Code returned by the URL:</p>
<table>
<thead>
<tr>
<th>Status</th>
<th>Health</th>
</tr>
</thead>
<tbody>
<tr>
<td>200-299</td>
<td>Healthy (Green)</td>
</tr>
<tr>
<td>429</td>
<td>Warning (Yellow)</td>
</tr>
<tr>
<td>Other / No Response</td>
<td>Unhealthy (Red)</td>
</tr>
</tbody>
</table>
<p>When using external health checks, it is recommended you build a variety of health URLs into your application to monitor the various mission critical aspects that can fail.
This way, you and your team have a simple means of being notified if/when one of those health checks reports a failure.</p>
<h3 id="configure-external-checks">Configure External Checks<a class="headerlink" href="#configure-external-checks" title="Permanent link">#</a></h3>
<p>XFRA provides a Layer0 Service to manage and configure your external checks.
Please review its <a href="https://gitlab.imshealth.com/xfra/layer1-shinken-ext/blob/master/README.md">README.md</a> for information on configuration options and usage.</p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../consul/" title="Consul">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Consul
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../task_definition/" title="Task Definitions">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Task Definitions
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>