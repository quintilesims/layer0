<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Upgrade - Layer0</title>
      
      
      
        <link rel="canonical" href="https://github.com/quintilesims/layer0/setup/update/">
      
      
        <meta name="author" content="xfra">
      
    
    <meta property="og:url" content="https://github.com/quintilesims/layer0/setup/update/">
    <meta property="og:title" content="Layer0">
    <meta property="og:image" content="https://github.com/quintilesims/layer0/setup/update//../../static/logo_icon.png">
    <meta name="apple-mobile-web-app-title" content="Layer0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../static/logo_icon.png">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-b64b728552.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Roboto', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-red palette-accent-grey">
    
      
      
        
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Setup <i class="icon icon-link"></i>
              
            
          </span>
        
        Upgrade
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/quintilesims/layer0/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../static/logo_icon.png">
        </div>
      
      <div class="name">
        <strong>Layer0 v0.8.4</strong>
        
          <br>
          quintilesims/layer0
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/quintilesims/layer0//archive/v0.8.4.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/quintilesims/layer0//stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Releases" href="../../releases/">
      Releases
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Introduction" href="../../intro/">
      Introduction
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Setup</span>
    <ul>
      
        
  <li>
    <a class="" title="Install" href="../install/">
      Install
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Upgrade" href="./">
      Upgrade
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Upgrading to version 0.8.4" href="#upgrading-to-version-084">
                Upgrading to version 0.8.4
              </a>
            </li>
          
            <li class="anchor">
              <a title="Upgrading from version 0.5.5 or earlier to the latest version of Layer0" href="#upgrading-from-version-055-or-earlier-to-the-latest-version-of-layer0">
                Upgrading from version 0.5.5 or earlier to the latest version of Layer0
              </a>
            </li>
          
            <li class="anchor">
              <a title="Upgrading from version 0.6.0 or 0.6.1 to the latest version of Layer0" href="#upgrading-from-version-060-or-061-to-the-latest-version-of-layer0">
                Upgrading from version 0.6.0 or 0.6.1 to the latest version of Layer0
              </a>
            </li>
          
            <li class="anchor">
              <a title="Upgrading version 0.7.x to 0.7.2" href="#upgrading-version-07x-to-072">
                Upgrading version 0.7.x to 0.7.2
              </a>
            </li>
          
            <li class="anchor">
              <a title="Upgrading versions not listed above" href="#upgrading-versions-not-listed-above">
                Upgrading versions not listed above
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Destroy" href="../destroy/">
      Destroy
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Guides</span>
    <ul>
      
        
  <li>
    <a class="" title="Guestbook" href="../../guides/guestbook/">
      Guestbook
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Guestbook with RDS" href="../../guides/guestbook_rds/">
      Guestbook with RDS
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Consul" href="../../guides/consul/">
      Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Guestbook with Consul" href="../../guides/guestbook_consul/">
      Guestbook with Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="One-off Task" href="../../guides/one_off_task/">
      One-off Task
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Reference</span>
    <ul>
      
        
  <li>
    <a class="" title="Layer0 CLI" href="../../reference/cli/">
      Layer0 CLI
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Layer0 Setup CLI" href="../../reference/setup-cli/">
      Layer0 Setup CLI
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Layer0 Terraform Plugin" href="../../reference/terraform-plugin/">
      Layer0 Terraform Plugin
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Updating a Service" href="../../reference/updateservice/">
      Updating a Service
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Consul" href="../../reference/consul/">
      Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Task Definitions" href="../../reference/task_definition/">
      Task Definitions
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Architecture" href="../../reference/architecture/">
      Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="ECR" href="../../reference/ecr/">
      ECR
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Troubleshooting</span>
    <ul>
      
        
  <li>
    <a class="" title="Common Issues" href="../../troubleshooting/commonissues/">
      Common Issues
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Secure Shell (SSH)" href="../../troubleshooting/ssh/">
      Secure Shell (SSH)
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="upgrade-layer0">Upgrade Layer0<a class="headerlink" href="#upgrade-layer0" title="Permanent link">#</a></h1>
<p>This section provides procedures for upgrading your Layer0 installation to the latest version.</p>
<p>The process of upgrading Layer0 differs depending on the version of Layer0 you are currently running, and the version you are upgrading to. Before continuing, determine which of the following sections applies to your current Layer0 installation:</p>
<ul>
<li><a href="#upgrading-to-version-084">Upgrading to version 0.8.4</a></li>
<li><a href="#upgrading-from-version-055-or-earlier-to-the-latest-version-of-layer0">Upgrading from version 0.5.5 or earlier to the latest version of Layer0</a></li>
<li><a href="#upgrading-from-version-060-or-061-to-the-latest-version-of-layer0">Upgrading from version 0.6.0 or 0.6.1 to the latest version of Layer0 0.6.2</a></li>
<li><a href="#upgrading-version-07x-to-072">Upgrading from version 0.7.x to 0.7.2</a></li>
<li><a href="#upgrading-versions-not-listed-above">Upgrading versions not listed above</a></li>
</ul>
<hr />
<h2 id="upgrading-to-version-084">Upgrading to version 0.8.4<a class="headerlink" href="#upgrading-to-version-084" title="Permanent link">#</a></h2>
<p>Layer0 Setup v0.8.4 contains changes to better support open source Layer0 installations.
The major changes are:  </p>
<ul>
<li>Replacing the <code>imshealthlabs</code> certificate with a self signed certificate</li>
<li>Removing the <code>docker_token</code> variable for <code>d.ims.io</code>, and using a <code>dockercfg</code> file to track private registry authentication</li>
</ul>
<p>As a result of these changes, terraform will fail to run against l0-setup files created prior to v0.8.4. 
Please create your v0.8.4 instances from scratch.
Be sure to follow our updated <a href="../../setup/install">installation</a> docs.</p>
<p>===</p>
<h2 id="upgrading-from-version-055-or-earlier-to-the-latest-version-of-layer0">Upgrading from version 0.5.5 or earlier to the latest version of Layer0<a class="headerlink" href="#upgrading-from-version-055-or-earlier-to-the-latest-version-of-layer0" title="Permanent link">#</a></h2>
<p>The architecture of Layer0 version 0.5.5 and earlier is not compatible with the architecture of more recent versions. For this reason, Layer0 versions 0.5.5 and earlier cannot be upgraded.</p>
<p>If you are using Layer0 0.5.5 or earlier and want to upgrade to a more recent version, we recommend that you create a new Layer0 using the current version of Layer0, and then migrate your services onto it by deploying your Docker task definitions into the new instance.</p>
<p>If you have questions about migrating from an older version of Layer0, email the development team at <a href="mailto:xfra@us.imshealth.com">xfra@us.imshealth.com</a>.</p>
<hr />
<h2 id="upgrading-from-version-060-or-061-to-the-latest-version-of-layer0">Upgrading from version 0.6.0 or 0.6.1 to the latest version of Layer0<a class="headerlink" href="#upgrading-from-version-060-or-061-to-the-latest-version-of-layer0" title="Permanent link">#</a></h2>
<p>In order to upgrade from version 0.6.0 or 0.6.1 to the current version of Layer0, you must first complete some steps that are specific to these versions of Layer0.</p>
<p>This upgrade will move your Layer0 API server from Elastic Beanstalk to the EC2 Container Server (ECS), which will change the URL of your Layer0 API endpoint. After completing the procedures in this section, you will need to update any references to the API endpoint in your projects.</p>
<p><strong>To update to the latest version:</strong></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Do not delete the <strong>l0</strong> or <strong>l0-setup</strong> files from version 0.6.0 or 0.6.1 until step 3&mdash;you will need these files to complete this upgrade process.</p>
<ol>
<li>In the <a href="../../index.html#download">Downloads section of the home page</a>, select the appropriate installation file for your operating system. Extract the zip file to a directory on your computer, but do not remove or replace the files from version 0.6.0 or 0.6.1.</li>
<li>Type the following command to destroy the ElasticBeanstalk resources, replacing <em>prefix</em> with the name of your Layer0 prefix:
<ul>
  <li class="command"><strong>l0-setup terraform</strong> <em>prefix</em> <strong>destroy -target aws_elastic_beanstalk_application.api</strong></li>
</ul></li>
<li>Type the following command to backup the state files for your Layer0:
<ul>
  <li class="command"><strong>l0-setup backup</strong> <em>prefix</em></li>
</ul></li>
<li>From the <a href="../../index.html#download">Downloads section of the home page</a>, select the appropriate installation file for your operating system. Extract the resulting zip file to your computer, and then replace the <strong>l0</strong> and <strong>l0-setup</strong> files that are already in your system path with the versions that you just downloaded.</li>
<li>
<p>Type the following command to determine which version of the <strong>l0-setup</strong> application you are running:
<ul>
  <li class="command"><strong>l0-setup --version</strong></li>
</ul>
The output of this command should equal the version number of the current version of Layer0.<br style="line-height:3em;" />
If you see the correct version number, proceed to the next step. Otherwise, ensure that you have replaced the <strong>l0</strong> and <strong>l0-setup</strong> files in your system path with the new versions of these files.</p>
</li>
<li>
<p>Type the following command to restore the state files:
<ul>
  <li class="command"><strong>l0-setup restore</strong> <em>prefix</em></li>
</ul></p>
</li>
<li>Type the following command to update the API Docker Image tag to the appropriate version:
<ul>
  <li class="command"><strong>l0-setup plan</strong> <em>prefix</em> <strong>-var api_docker_image_tag=</strong><em>vX.Y.Z</em></li>
  <li class="command">Replace <em>vX.Y.Z</em> in the command above with the version number of the current version of Layer0.</li>
</ul></li>
<li>
<p>Type the following command to apply the current version of Layer0:
<ul>
  <li class="command"><strong>l0-setup apply</strong> <em>prefix</em></li>
</ul></p>
</li>
<li>
<p>At this point, the environment variables already applied to your shell will no longer be valid. Type the following command to view the new environment variables and apply them to your shell:</p>
</li>
<li>(Windows PowerShell): <strong>l0-setup endpoint --insecure --powershell</strong> <em>prefix</em> <strong>| Out-String | Invoke-Expression</strong></li>
<li>(Linux/Mac): <strong>eval "$(l0-setup endpoint --insecure</strong> <em>prefix</em><strong>)"</strong></li>
</ol>
<h3 id="versions-supported-by-these-procedures">Versions supported by these procedures<a class="headerlink" href="#versions-supported-by-these-procedures" title="Permanent link">#</a></h3>
<p>The procedures above are known to work when migrating between the versions listed in the following table:</p>
<table>
<thead>
<tr>
<th>Existing version</th>
<th>New version</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.6.0</td>
<td>0.6.2</td>
</tr>
<tr>
<td>0.6.0</td>
<td>0.6.3</td>
</tr>
<tr>
<td>0.6.1</td>
<td>0.6.2</td>
</tr>
<tr>
<td>0.6.1</td>
<td>0.6.3</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="upgrading-version-07x-to-072">Upgrading version 0.7.x to 0.7.2<a class="headerlink" href="#upgrading-version-07x-to-072" title="Permanent link">#</a></h2>
<p>The commands <strong>service logs</strong> and <strong>task logs</strong> will not work for Services and Tasks created prior to version 0.7.2.
You will likely get an error: <code>AWS Error: the specified log group does not exist</code>.
You must re-create your Service in order for Layer0 to create the proper log group.</p>
<hr />
<h2 id="upgrading-versions-not-listed-above">Upgrading versions not listed above<a class="headerlink" href="#upgrading-versions-not-listed-above" title="Permanent link">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>If you have already completed the upgrade procedures listed in one of the sections above, you do not need to complete the procedures in this section.</p>
<p><strong>To upgrade to a new version of Layer0:</strong></p>
<ol>
<li>In the <a href="../../index.html#download">Downloads section of the home page</a>, select the appropriate installation file for your operating system. Extract the zip file to a directory on your computer, and then move the <strong>l0</strong> and <strong>l0-setup</strong> files to a folder in your system path, replacing any previous versions of these files.</li>
<li>Follow the instructions for creating an <a href="../install/#part-2-create-an-access-key">Administrator Access Key</a>. You will use this access key when l0-setup prompts you for AWS credentials.</li>
<li>Type the following command to verify that you are working with the correct version of Layer0:
<ul>
  <li class="command"><strong>l0-setup --version</strong></li>
</ul>
The output of this command should display the version number of the most recent version of Layer0. If it does, proceed to the next step; if not, ensure that you copied the latest versions of <strong>l0</strong> and <strong>l0-setup</strong> to the appropriate directories in your system path.</li>
<li>
<p>Type the following command to restore the state files for your Layer0, replacing <em>prefix</em> with the name of your Layer0 prefix:
<ul>
  <li class="command"><strong>l0-setup restore</strong> <em>prefix</em></li>
</ul></p>
</li>
<li>
<p>Type the following command to update your api image tag:
<ul>
  <li class="command"><strong>l0-setup plan</strong> <em>prefix</em> <strong>-var api_docker_image_tag</strong>=<em>version</em> </li>
</ul></p>
</li>
<li>
<p>(<strong>This setup is only required when upgrading to v0.7.0 and higher</strong>) Type the following command to update your runner image tag:
<ul>
  <li class="command"><strong>l0-setup plan</strong> <em>prefix</em> <strong>-var runner_version_tag</strong>=<em>version</em> </li>
</ul></p>
</li>
<li>
<p>Type the following command to update your AWS Access Key ID from step 2:
<ul>
  <li class="command"><strong>l0-setup plan</strong> <em>prefix</em> <strong>-var api_access_key</strong>=<em>access_key_id</em> </li>
</ul></p>
</li>
<li>
<p>Type the following command to update your AWS Secret Access Key from step 2:
<ul>
  <li class="command"><strong>l0-setup plan</strong> <em>prefix</em> <strong>-var api_secret_key</strong>=<em>secret_key</em> </li>
</ul></p>
</li>
<li>
<p>Type the following command to apply the upgrade:
<ul>
  <li class="command"><strong>l0-setup apply</strong> <em>prefix</em></li>
</ul></p>
</li>
</ol>
<h3 id="versions-supported-by-these-procedures_1">Versions supported by these procedures<a class="headerlink" href="#versions-supported-by-these-procedures_1" title="Permanent link">#</a></h3>
<p>The procedures above are known to work when migrating between the versions listed in the following table:</p>
<table>
<thead>
<tr>
<th>Existing version</th>
<th align="center"></th>
<th>New version</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.6.2</td>
<td align="center">&rarr;</td>
<td>&gt; 0.6.2</td>
</tr>
<tr>
<td>0.6.3</td>
<td align="center">&rarr;</td>
<td>&gt; 0.6.3</td>
</tr>
<tr>
<td>0.7.0</td>
<td align="center">&rarr;</td>
<td>0.7.1</td>
</tr>
</tbody>
</table>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../install/" title="Install">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Install
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../destroy/" title="Destroy">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Destroy
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = 'quintilesims/layer0';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>