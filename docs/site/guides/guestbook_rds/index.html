<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Guestbook with RDS - Layer0</title>
      
      
      
        <link rel="canonical" href="https://gitlab.imshealth.com/xfra/layer0/guides/guestbook_rds/">
      
      
        <meta name="author" content="xfra">
      
    
    <meta property="og:url" content="https://gitlab.imshealth.com/xfra/layer0/guides/guestbook_rds/">
    <meta property="og:title" content="Layer0">
    <meta property="og:image" content="https://gitlab.imshealth.com/xfra/layer0/guides/guestbook_rds//../../static/logo_icon.png">
    <meta name="apple-mobile-web-app-title" content="Layer0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
      <link rel="apple-touch-icon" href="../../static/logo_icon.png">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-b64b728552.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Roboto', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-red palette-accent-grey">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Guides <i class="icon icon-link"></i>
              
            
          </span>
        
        Guestbook with RDS
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://gitlab.imshealth.com/xfra/layer0/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../static/logo_icon.png">
        </div>
      
      <div class="name">
        <strong>Layer0 v0.8.2</strong>
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Releases" href="../../releases/">
      Releases
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Introduction" href="../../intro/">
      Introduction
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Setup</span>
    <ul>
      
        
  <li>
    <a class="" title="Install" href="../../setup/install/">
      Install
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Upgrade" href="../../setup/update/">
      Upgrade
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Destroy" href="../../setup/destroy/">
      Destroy
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Guides</span>
    <ul>
      
        
  <li>
    <a class="" title="Guestbook" href="../guestbook/">
      Guestbook
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="Guestbook with RDS" href="./">
      Guestbook with RDS
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Before you start" href="#before-you-start">
                Before you start
              </a>
            </li>
          
            <li class="anchor">
              <a title="Part 1: Create an RDS instance" href="#part-1-create-an-rds-instance">
                Part 1: Create an RDS instance
              </a>
            </li>
          
            <li class="anchor">
              <a title="Part 2: Create a deploy" href="#part-2-create-a-deploy">
                Part 2: Create a deploy
              </a>
            </li>
          
            <li class="anchor">
              <a title="Part 3: Apply the deploy" href="#part-3-apply-the-deploy">
                Part 3: Apply the deploy
              </a>
            </li>
          
            <li class="anchor">
              <a title="Part 4: Test the application" href="#part-4-test-the-application">
                Part 4: Test the application
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Consul" href="../consul/">
      Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Guestbook with Consul" href="../guestbook_consul/">
      Guestbook with Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Shinken" href="../shinken/">
      Shinken
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Reference</span>
    <ul>
      
        
  <li>
    <a class="" title="Layer0 CLI" href="../../reference/cli/">
      Layer0 CLI
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Layer0 Setup CLI" href="../../reference/setup-cli/">
      Layer0 Setup CLI
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Consul" href="../../reference/consul/">
      Consul
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Shinken" href="../../reference/shinken/">
      Shinken
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Task Definitions" href="../../reference/task_definition/">
      Task Definitions
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Architecture" href="../../reference/architecture/">
      Architecture
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="ECR" href="../../reference/ecr/">
      ECR
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Troubleshooting</span>
    <ul>
      
        
  <li>
    <a class="" title="Common Issues" href="../../troubleshooting/commonissues/">
      Common Issues
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Secure Shell (SSH)" href="../../troubleshooting/ssh/">
      Secure Shell (SSH)
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="deployment-guide-guestbook-with-rds-database">Deployment guide: Guestbook with RDS Database<a class="headerlink" href="#deployment-guide-guestbook-with-rds-database" title="Permanent link">#</a></h1>
<p>The Guestbook application that you deployed in the <a href="../../guides/guestbook">Guestbook deployment guide</a> was a very simple application that stored its data in memory (also known as a "stateful" application). If you were to re-deploy the Guestbook service, all of the data previously entered into the application would be lost permanently.</p>
<p>A stateless application, on the other hand, does not record data generated in one session for use in subsequent sessions. In order to prevent data loss, web applications that you deploy using Layer0 should be stateless.</p>
<p>This guide will show you how to make a stateless Guestbook application that stores data in an Amazon Relational Database Service (RDS) database.</p>
<hr />
<h2 id="before-you-start">Before you start<a class="headerlink" href="#before-you-start" title="Permanent link">#</a></h2>
<p>In order to complete the procedures in this section, you must install and configure Layer0 v0.7.0 or later. If you have not already configured Layer0, see the <a href="../../setup/install">installation guide</a>. If you are running an older version of Layer0, see the <a href="../../setup/update#upgrading-older-versions-of-layer0">upgrade instructions</a>.</p>
<p>This guide expands upon the <a href="../../guides/guestbook">Guestbook deployment guide</a> deployment guide. You must complete the procedures in that guide before you can complete the procedures listed here. After completing the procedures in the Guestbook guide, your Layer0 should contain a service named "guestbooksvc", running a deploy named "guestbook", behind a load balancer named "guestbooklb", all within an environment named "demo".</p>
<h2 id="part-1-create-an-rds-instance">Part 1: Create an RDS instance<a class="headerlink" href="#part-1-create-an-rds-instance" title="Permanent link">#</a></h2>
<p>The updated Guestbook application described in this guide stores its data in an Amazon Relational Database Service (RDS) database. These steps describe the process of creating a new RDS instance for this purpose.</p>
<p><strong>To create a new RDS database:</strong></p>
<ol>
<li>Download the <a href="https://gitlab.imshealth.com/xfra/layer0-samples/blob/master/rds/cloudformation.json">RDS Cloudformation script</a> and save it to your computer.</li>
<li>Go to <a href="https://imshealth.auth0.com/samlp/dD95hSDud43w6tu0KiQTanigF2FzJccA">the AWS Console page for Layer0</a>. Log in using your IMS Health domain credentials.</li>
<li>Under <strong>Management Tools</strong>, click <strong>CloudFormation</strong>.</li>
<li>Click <strong>Create Stack</strong>.</li>
<li>Next to <strong>Choose a Template</strong>, select <strong>Upload a template to Amazon S3</strong>. Click the <strong>Browse</strong> button. On the file selection window, select the file that you downloaded in step 1 (<strong>cloudformation.json</strong>), and then click <strong>Next</strong>.</li>
<li>Under <strong>Parameters</strong>, enter the following details:<ul>
<li><strong>Stack Name</strong>: <em>Layer0Prefix</em><strong>-guestbook-rds</strong></li>
<li><strong>Database</strong>: <strong>guestbook</strong></li>
<li><strong>EnvironmentSG</strong>: Select the item that starts with <em>Layer0Prefix</em><strong>-demo</strong></li>
<li><strong>Password</strong>: a password that you specify. The password must contain at least 8 characters. It cannot contain spaces or any of the following characters: /, @, "</li>
<li><strong>Port</strong>: 3306</li>
<li><strong>Username</strong>: a username that you specify.</li>
<li><strong>Subnets</strong>: Select the items that end with <strong>(layer0-</strong><em>Layer0Prefix</em><strong>-priA)</strong> and <strong>(layer0-</strong><em>Layer0Prefix</em><strong>-priB)</strong></li>
<li><strong>VPC</strong>: Select the item that ends with <strong>(layer0-</strong><em>Layer0Prefix</em><strong>-vpc)</strong></li>
</ul>
</li>
<li>Click <strong>Next</strong> until you arrive at the Review page. Click <strong>Create</strong>. The process of creating the stack requires about 10 minutes to complete; wait until this process is complete before proceeding to the next section.</li>
</ol>
<h2 id="part-2-create-a-deploy">Part 2: Create a deploy<a class="headerlink" href="#part-2-create-a-deploy" title="Permanent link">#</a></h2>
<p>After the RDS database is ready, you can create a new deploy for the service.</p>
<p><strong>To create a new deploy:</strong></p>
<ol>
<li>Download the <a href="https://gitlab.imshealth.com/xfra/layer0-samples/blob/master/rds/Dockerrun.aws.json">RDS Guestbook Task Definition</a> and save it to your computer as <strong>GuestbookRDS.Dockerrun.aws.json</strong>.</li>
<li>In the AWS Console, under <strong>Management Tools</strong>, click <strong>CloudFormation</strong>, and then click the name of the stack you created in the previous section. Click <strong>Outputs</strong> to see a list of the variables you specified in the previous section.</li>
<li>In a text editor, open the GuestbookRDS.Dockerrun.aws.json file. This file uses environment variables for configuration. Edit the file to use the appropriate values for your stack. When you are finished, the <strong>environment</strong> section should resemble the following example:
<pre>
...
"environment": [
    {
        "name": "GB_DB_NAME",
        "value": "guestbook"
    },
    {
        "name": "GB_DB_HOST",
        "value": "guestbook.abc123.us-west-2.rds.amazonaws.com"
    },
    {
        "name": "GB_DB_PORT",
        "value": "3306"
    },
    {
        "name": "GB_DB_USER",
        "value": "admin"
    },
    {
        "name": "GB_DB_PASSWORD",
        "value": "password"
    }
]
...
</pre></li>
<li>Save the changes you made to <strong>GuestbookRDS.Dockerrun.aws.json</strong>.</li>
<li>At the command prompt, run the following command:</li>
</ol>
<p><span style="padding-left:2em"><strong>l0 deploy create GuestbookRDS.Dockerrun.aws.json guestbook</strong></span></p>
<p>You will see the following output:</p>
<div class="code"><pre>DEPLOY ID       DEPLOY NAME  VERSION
1guestbook:2    guestbook    2
</pre></div>


<p>The number 2 in the <strong>Version</strong> column indicates that this is the second iteration of this deploy (the deploy from the previous guestbook example was the first iteration).</p>
<h2 id="part-3-apply-the-deploy">Part 3: Apply the deploy<a class="headerlink" href="#part-3-apply-the-deploy" title="Permanent link">#</a></h2>
<p>At this point, you can use the <strong>deploy</strong> command to deploy the latest version of the deploy named "guestbook" to our existing service ("guestbooksvc"). Using this command will instruct the service to run the new version of the Guestbook container, along with the environment variables you specified in the task definition in the previous section.</p>
<p>To apply the deploy, run the following command:</p>
<p><span style="padding-left:2em"><strong>l0 deploy apply guestbook:2 demo:guestbooksvc</strong></span></p>
<p>You will see the following output:</p>
<div class="code"><pre>Successfully Applied Deploy
</pre></div>


<h2 id="part-4-test-the-application">Part 4: Test the application<a class="headerlink" href="#part-4-test-the-application" title="Permanent link">#</a></h2>
<h3 id="check-the-status-of-the-service">Check the status of the service<a class="headerlink" href="#check-the-status-of-the-service" title="Permanent link">#</a></h3>
<p>After you create a service, it may take several minutes for that service to completely finish deploying. You can check the status of a service using the <strong>service get</strong> command.</p>
<p>To check the status of the guestbook service, run the following command:
<ul>
  <li class="command"><strong>l0 service get demo:guestbooksvc</strong></li>
</ul><br />
Initially, you will see an asterisk (*) next to the name of the "guestbook:1" deploy; this indicates that the service is in a transitional state. In this phase, if you execute the <strong>service get</strong> command again, you will see the following output:</p>
<div class="code"><pre>SERVICE ID      SERVICE NAME  ENVIRONMENT  LOADBALANCER     DEPLOYS       SCALE
1guestbooksvc   guestbook     demo         guestbooklb      guestbook:2*  1/1
                                                            guestbook:1
</pre></div>


<p>In the next phase of the deployment, you will see "(1)" in the Scale column; this indicates that 1 copy of the service is transitioning to an active state. In this phase, if you execute the <strong>service get</strong> command again, you will see the following output:</p>
<div class="code"><pre>SERVICE ID      SERVICE NAME  ENVIRONMENT  LOADBALANCER     DEPLOYS       SCALE
1guestbooksvc   guestbook     demo         guestbooklb      guestbook:2*  1/1 (1)
                                                            guestbook:1
</pre></div>


<p>The system will wait until the guestbook:2 deploy is running before it stops the currently-running guestbook:1 deploy. In this phase, if you execute the <strong>service get</strong> command again, you will see the following output:</p>
<div class="code"><pre>SERVICE ID      SERVICE NAME  ENVIRONMENT  LOADBALANCER     DEPLOYS       SCALE
1guestbooksvc   guestbook     demo         guestbooklb      guestbook:2   2/1
                                                            guestbook:1
</pre></div>


<p>Once the guestbook:2 deploy is running, the guestbook:1 deploy will be stopped.
The Deploys and Scale columns will indicate that only one deploy (the guestbook:2 deploy) is running. In this phase, if you execute the <strong>service get</strong> command again, you will see the following output:</p>
<div class="code"><pre>SERVICE ID      SERVICE NAME  ENVIRONMENT  LOADBALANCER     DEPLOYS      SCALE
1guestbooksvc   guestbook     demo         guestbooklb      guestbook:2  1/1
</pre></div>


<h3 id="get-the-application-url">Get the application URL<a class="headerlink" href="#get-the-application-url" title="Permanent link">#</a></h3>
<p>Once the service has been completely deployed, you can obtain the URL for your application and launch it in a browser.</p>
<p><strong>To test the RDS guestbook application:</strong></p>
<ol>
  <li>At the command line, type the following command:
    <ul>
      <li class="command"><strong>l0 loadbalancer get demo:guestbooklb</strong></li>
    </ul><br />
  You will see the following output:
<pre class="code"><code>LOADBALANCER ID  LOADBALANCER NAME  ENVIRONMENT  SERVICES            PORTS       PUBLIC  URL
1guestbooklb     guestbooklb        demo         1guestbooksvc99706  80:80/HTTP  true    <em>(url)</em>
</code></pre>
  </li>
  <li>Copy the value shown in the <strong>URL</strong> column and paste it into a web browser. The RDS-backed guestbook application will appear.</li>
</ol>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../guestbook/" title="Guestbook">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Guestbook
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../consul/" title="Consul">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Consul
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>